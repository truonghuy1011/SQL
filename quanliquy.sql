CREATE DATABASE QUANLIQUYTUTHIEN
GO
USE QUANLIQUYTUTHIEN
GO

--TAO BANG
CREATE TABLE NHANVIEN(
   MANV CHAR(10)NOT NULL,
   TENNV NVARCHAR(100),
   ĐCNV NVARCHAR(100),
   SĐTNV CHAR(10),
   NGAYNHAMCHUC DATE,
   MACHUCVU CHAR(10)NOT NULL,
   PRIMARY KEY(MANV),
   CONSTRAINT FK_NHANVIEN_MACHUCVU FOREIGN KEY (MACHUCVU) REFERENCES CHUCVU(MACHUCVU)
);

CREATE TABLE CHUCVU(
   MACHUCVU CHAR(10)NOT NULL,
   TENCHUCVU NVARCHAR(100), 
   PRIMARY KEY(MACHUCVU),
);

CREATE TABLE NHAHAOTAM(
   MANHT CHAR(10)NOT NULL,
   TENNHT NVARCHAR(100),
   ĐCNHT NVARCHAR(100),
   SĐTNHT CHAR(10),
   PRIMARY KEY(MANHT),
);

CREATE TABLE NHATAITRO(
   MANTT CHAR(10)NOT NULL,
   TENNTT NVARCHAR(100),
   ĐCNTT NVARCHAR(100),
   SĐTNTT CHAR(10),
   EMAIL VARCHAR(100),
   PRIMARY KEY(MANTT),
);

CREATE TABLE THONGTINTAITRO(
   MATT CHAR(10)NOT NULL,
   MANTT CHAR(10)NOT NULL,
   MUCDICH NVARCHAR(100),
   VATTAITRO MONEY,
   PRIMARY KEY(MATT),
   CONSTRAINT FK_TONGTINTAITRO_MANTT FOREIGN KEY (MANTT) REFERENCES NHATAITRO(MANTT)
);

CREATE TABLE DOITUONGTHUHUONG(
   MAĐT CHAR(10)NOT NULL,
   TENĐT NVARCHAR(100),
   NGHENGHIEP NVARCHAR(100),
   HOANCANH NVARCHAR(200),
   PRIMARY KEY(MAĐT),
);

CREATE TABLE HOTRO(
   MAHOTRO CHAR(10)NOT NULL,
   MAĐT CHAR(10)NOT NULL,
   MANHT CHAR(10)NOT NULL,
   VATHOTRO NVARCHAR(100),
   NGAYHOTRO DATE,
   PRIMARY KEY(MAHOTRO),
   CONSTRAINT FK_HOTRO_MAĐT FOREIGN KEY (MAĐT) REFERENCES DOITUONGTHUHUONG(MAĐT),
   CONSTRAINT FK_HOTRO_MANHT FOREIGN KEY (MANHT) REFERENCES NHAHAOTAM(MANHT)
);

CREATE TABLE CHUONGTRINHQUY(
   MAQUY CHAR(10)NOT NULL,
   TENQUY NVARCHAR(100),
   MANV CHAR(10)NOT NULL,
   MAHOTRO CHAR(10)NOT NULL,
   MATT CHAR(10)NOT NULL,
   PRIMARY KEY (MAQUY),
   CONSTRAINT FK_CHUONGTRINHQUY_MANV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV),
   CONSTRAINT FK_CHUONGTRINHQUY_MAHOTRO FOREIGN KEY (MAHOTRO) REFERENCES HOTRO(MAHOTRO),
   CONSTRAINT FK_CHUONGTRINHQUY_MATT FOREIGN KEY (MATT) REFERENCES THONGTINTAITRO(MATT)
);

 
 --THEM DU LIEU
 insert into NHANVIEN(MANV, TENNV, ĐCNV,SĐTNV,NGAYNHAMCHUC,MACHUCVU)
Values ('NV001',N'Nguyễn Đình Hoàng',N'1 Lê Văn Luyện tphcm','0987654321','20170303','001')
insert into NHANVIEN(MANV, TENNV, ĐCNV,SĐTNV,NGAYNHAMCHUC,MACHUCVU)
Values ('NV002',N'Nguyễn Văn Hiệp',N'2 Tần Hưng Đạo DakLak','0987654312','20170404','002')
insert into NHANVIEN(MANV, TENNV, ĐCNV,SĐTNV,NGAYNHAMCHUC,MACHUCVU)
Values ('NV003',N'Nguyễn Thị Thu Cẩm',N'3 Hoàng Hoa Thám Quảng Ngãi','0987654333','20170505','003')
insert into NHANVIEN(MANV, TENNV, ĐCNV,SĐTNV,NGAYNHAMCHUC,MACHUCVU)
Values ('NV004',N'Nguyễn Thị Thu Hồng',N'4 Lê Lợi Quảng Ngãi','0987654322','20170606','004')
insert into NHANVIEN(MANV, TENNV, ĐCNV,SĐTNV,NGAYNHAMCHUC,MACHUCVU)
Values ('NV005',N'Nguyễn Viết Vũ',N'5 Lê Lai Quảng Ngãi','0986654322','20170707','005')
--
insert into CHUCVU(MACHUCVU, TENCHUCVU)
Values ('001',N'Giám Đốc')
insert into CHUCVU(MACHUCVU, TENCHUCVU)
Values ('002',N'Quản Lý')
insert into CHUCVU(MACHUCVU, TENCHUCVU)
Values ('003',N'Nhân Sự')
insert into CHUCVU(MACHUCVU, TENCHUCVU)
Values ('004',N'Kế Toán')
insert into CHUCVU(MACHUCVU, TENCHUCVU)
Values ('005',N'Hậu Cần')
--
insert into DOITUONGTHUHUONG(MAĐT, TENĐT,NGHENGHIEP,HOANCANH)
Values ('DT001',N'Lê Quang Vũ',N'Bán vé số',N'Què hai chân và bị mù lòat')
insert into DOITUONGTHUHUONG(MAĐT, TENĐT,NGHENGHIEP,HOANCANH)
Values ('DT002',N'Nguyễn Hữu Thuận',N'Thu mua ve chai',N'Uống nước gạo thay sữa')
insert into DOITUONGTHUHUONG(MAĐT, TENĐT,NGHENGHIEP,HOANCANH)
Values ('DT003',N'Lê Văn Tú',N'Bán thân',N'Nghèo không đủ tiền ăn')
insert into DOITUONGTHUHUONG(MAĐT, TENĐT,NGHENGHIEP,HOANCANH)
Values ('DT004',N'Nguyễn Hoàng Dương',N'Bán cơm',N'Không đủ tiền chữa bệnh')
insert into DOITUONGTHUHUONG(MAĐT, TENĐT,NGHENGHIEP,HOANCANH)
Values ('DT005',N'Đào Đức Đạt',N'Bán dép',N'Thường xuyên ngủ dưới gầm cầu')
--
insert into NHATAITRO(MANTT, TENNTT,ĐCNTT,SĐTNTT,EMAIL)
Values ('NTT001',N'Công ty Dạ Hương',N'6 Trần Đại Nghĩa,Lào Cai','0123456789','dahuong@gmail.com')
insert into NHATAITRO(MANTT, TENNTT,ĐCNTT,SĐTNTT,EMAIL)
Values ('NTT002',N'Công ty Durex',N'7 Trần Quốc Toản,Hà Nội','0123456799','durex@gmail.com')
insert into NHATAITRO(MANTT, TENNTT,ĐCNTT,SĐTNTT,EMAIL)
Values ('NTT003',N'Công ty Vinamilk',N'8 Trần Nhân Tông,Vĩnh Phúc','0123456788','vinamilk@gmail.com')
insert into NHATAITRO(MANTT, TENNTT,ĐCNTT,SĐTNTT,EMAIL)
Values ('NTT004',N'Công ty Kinh Đô',N'9 Trần Hưng Đạo,Huế','0123456777','kinhdo@gmail.com')
insert into NHATAITRO(MANTT, TENNTT,ĐCNTT,SĐTNTT,EMAIL)
Values ('NTT005',N'Công ty Pizza Hut',N'10 Trần Đại Nghĩa,Lào Cai','0123456666','pizzahut@gmail.com')
--
insert into NHAHAOTAM(MANHT, TENNHT,ĐCNHT,SĐTNHT)
Values ('NHT001',N'Bùi Minh Tuấn',N'11 Lê Quang Định,Tiền Giang ','0987987987')
insert into NHAHAOTAM(MANHT, TENNHT,ĐCNHT,SĐTNHT)
Values ('NHT002',N'Lê Nhật Hoàng',N'12 Lê Thái Tông,Đồng tháp','0654654654')
insert into NHAHAOTAM(MANHT, TENNHT,ĐCNHT,SĐTNHT)
Values ('NHT003',N'Nguyễn Văn Vân',N'13 Lê Lai,Đồng Nai','0321321321')
insert into NHAHAOTAM(MANHT, TENNHT,ĐCNHT,SĐTNHT)
Values ('NHT004',N'Phạm Duy Tấn',N'14 Lê Văn Việt,tphcm','0876876876')
insert into NHAHAOTAM(MANHT, TENNHT,ĐCNHT,SĐTNHT)
Values ('NHT005',N'Nguyễn Tài Trung',N'15 Lê Đức Thọ,Bến Tre','0543654312')
--
insert into THONGTINTAITRO(MATT, MANTT,MUCDICH,VATTAITRO)
Values ('TT001','NTT001',N'mở rộng quỹ từ thiện',N'50000000000')
insert into THONGTINTAITRO(MATT, MANTT,MUCDICH,VATTAITRO)
Values ('TT002','NTT002',N'cung cấp kinh phí để duy trì quỹ',N'50000000000')
insert into THONGTINTAITRO(MATT, MANTT,MUCDICH,VATTAITRO)
Values ('TT003','NTT003',N'mở thêm bệnh viện từ thiện',N'50000000000')
insert into THONGTINTAITRO(MATT, MANTT,MUCDICH,VATTAITRO)
Values ('TT004','NTT004',N'mở thêm quán cơm từ thiện',N'50000000000')
insert into THONGTINTAITRO(MATT, MANTT,MUCDICH,VATTAITRO)
Values ('TT005','NTT005',N'mở thêm mái ấm tình thương',N'500000000')
--
insert into HOTRO(MAHOTRO, MAĐT,MANHT,VATHOTRO,NGAYHOTRO)
Values ('HT001','DT001','NHT001',N'Gạo','20180303')
insert into HOTRO(MAHOTRO, MAĐT,MANHT,VATHOTRO,NGAYHOTRO)
Values ('HT002','DT002','NHT002',N'Bánh','20180404')
insert into HOTRO(MAHOTRO, MAĐT,MANHT,VATHOTRO,NGAYHOTRO)
Values ('HT003','DT003','NHT003',N'Áo','20180404')
insert into HOTRO(MAHOTRO, MAĐT,MANHT,VATHOTRO,NGAYHOTRO)
Values ('HT004','DT004','NHT004',N'Dầu ăn','20180505')
insert into HOTRO(MAHOTRO, MAĐT,MANHT,VATHOTRO,NGAYHOTRO)
Values ('HT005','DT005','NHT005',N'Mắm','20180606')
--
insert into CHUONGTRINHQUY(MAQUY, TENQUY,MANV,MAHOTRO,MATT)
Values ('QUY001',N'Quán cơm 2000','NV001','HT001','TT001')
insert into CHUONGTRINHQUY(MAQUY, TENQUY,MANV,MAHOTRO,MATT)
Values ('QUY002',N'Bệnh viện tình thương','NV002','HT002','TT002')
insert into CHUONGTRINHQUY(MAQUY, TENQUY,MANV,MAHOTRO,MATT)
Values ('QUY003',N'Mái ấm tình thương','NV003','HT003','TT003')
insert into CHUONGTRINHQUY(MAQUY, TENQUY,MANV,MAHOTRO,MATT)
Values ('QUY004',N'Nụ cười hồng','NV004','HT004','TT004')
insert into CHUONGTRINHQUY(MAQUY, TENQUY,MANV,MAHOTRO,MATT)
Values ('QUY005',N'Lớp học tình thương','NV005','HT005','TT005')

-----------------------------------------TRIGGER-----------------------------------------
GO
ALTER TRIGGER TG_NGAYNHANCHUC ON NHANVIEN FOR INSERT
AS 
BEGIN
	DECLARE @MANV CHAR(10), @NGAYNHAMCHUC DATE
	IF((SELECT NHANVIEN.NGAYNHAMCHUC 
	FROM NHANVIEN INNER JOIN INSERTED 
	ON NHANVIEN.NGAYNHAMCHUC = INSERTED.NGAYNHAMCHUC) > GETDATE())
		BEGIN
			PRINT N'NGÀY NHẬN CHỨC KHÔNG ĐƯỢC LỚN HƠN NGÀY HIỆN TẠI'
			ROLLBACK TRAN
		END
END

GO
ALTER TRIGGER TG_VATTAITRO ON THONGTINTAITRO FOR UPDATE
AS
BEGIN
	IF((SELECT THONGTINTAITRO.VATTAITRO 
	FROM THONGTINTAITRO INNER JOIN INSERTED 
	ON THONGTINTAITRO.VATTAITRO = INSERTED.VATTAITRO) = '0')
		BEGIN
			PRINT N'SỐ LƯỢNG VẬT TÀI TRỢ KHÔNG ĐƯỢC 0 HOẶC NULL'
			ROLLBACK TRAN
		END
END


